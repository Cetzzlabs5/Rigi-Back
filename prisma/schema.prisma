generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ProviderGeneralStatus {
  ACTIVE
  SUSPENDED
}

enum LawScope {
  PROVINCIAL
  NATIONAL
}

enum RequirementType {
  DOCUMENTARY
  LOGICAL
  TECHNICAL
}

enum ValidationResult {
  APPROVED
  REJECTED
}

enum ProviderLawStatus {
  APPROVED
  REJECTED
  OBSERVED
}

enum ValidatorType {
  SYSTEM
  USER
}

enum UserRole {
  ADMIN
  PROVIDER
  MINING_COMPANY
}

model User {
  id              String          @id @default(uuid())
  legalName       String
  email           String          @unique
  cuit            String          @unique
  role            UserRole
  password        String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  providers       Provider[]
  miningCompanies MiningCompany[]
}

model Provider {
  id            String                @id @default(uuid())
  mainActivity  String
  phone         String
  address       String
  province      String
  generalStatus ProviderGeneralStatus
  userId        String
  user          User                  @relation(fields: [userId], references: [id])
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt

  documents   Document[]
  lawStatuses ProviderLawStatusEntity[]
}

model MiningCompany {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])
}

model Law {
  id          String   @id @default(uuid())
  code        String
  name        String
  description String
  scope       LawScope
  isActive    Boolean
  createdAt   DateTime @default(now())

  requirements Requirement[]
  providers    ProviderLawStatusEntity[]
}

model Requirement {
  id          String          @id @default(uuid())
  lawId       String
  name        String
  description String
  type        RequirementType
  isMandatory Boolean

  law       Law        @relation(fields: [lawId], references: [id])
  documents Document[]
}

model Document {
  id             String   @id @default(uuid())
  providerId     String
  requirementId  String
  documentType   String
  fileUrl        String
  fileHash       String
  issueDate      DateTime
  expirationDate DateTime
  createdAt      DateTime @default(now())

  provider    Provider     @relation(fields: [providerId], references: [id])
  requirement Requirement  @relation(fields: [requirementId], references: [id])
  validations Validation[]
}

model Validation {
  id               String           @id @default(uuid())
  documentId       String
  technicalResult  ValidationResult
  logicalResult    ValidationResult
  regulatoryResult ValidationResult
  notes            String
  validatedBy      ValidatorType
  createdAt        DateTime         @default(now())

  document Document @relation(fields: [documentId], references: [id])
}

model ProviderLawStatusEntity {
  id             String            @id @default(uuid())
  providerId     String
  lawId          String
  status         ProviderLawStatus
  reviewDate     DateTime
  expirationDate DateTime

  provider Provider @relation(fields: [providerId], references: [id])
  law      Law      @relation(fields: [lawId], references: [id])

  @@unique([providerId, lawId])
}

model AuditLog {
  id        String   @id @default(uuid())
  entity    String
  entityId  String
  action    String
  details   String
  createdAt DateTime @default(now())
}
