generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum ProviderGeneralStatus {
  ACTIVE
  SUSPENDED
}

enum LawScope {
  PROVINCIAL
  NATIONAL
}

enum RequirementType {
  DOCUMENTARY
  LOGICAL
  TECHNICAL
}

enum ValidationResult {
  APPROVED
  REJECTED
}

enum DocStatus {
  PENDING
  PROCESSING
  VERIFIED
  REJECTED
}

enum ProviderLawStatus {
  APPROVED
  REJECTED
  OBSERVED
}

enum ValidatorType {
  SYSTEM
  USER
}

enum UserRole {
  ADMIN
  PROVIDER
  MINING_COMPANY
}

model Token {
  id        String   @id @default(uuid())
  token     String
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model User {
  id            String         @id @default(uuid())
  legalName     String
  email         String         @unique
  cuit          String         @unique
  role          UserRole
  password      String
  isActive      Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  provider      Provider?
  miningCompany MiningCompany?
  tokens        Token[]
}

model Provider {
  id   String @id
  user User   @relation(fields: [id], references: [id])

  providerActivity   ProviderActivity? @relation(fields: [providerActivityId], references: [id])
  providerActivityId String?

  phone         String
  address       String
  province      String
  generalStatus ProviderGeneralStatus

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  documents   Document[]
  lawStatuses ProviderLawStatusEntity[]
}

model ProviderActivity {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())

  providers Provider[]
}

model MiningCompany {
  id   String @id
  user User   @relation(fields: [id], references: [id])
}

model Law {
  id          String   @id @default(uuid())
  code        String
  name        String
  description String
  scope       LawScope
  isActive    Boolean
  createdAt   DateTime @default(now())

  requirements Requirement[]
  providers    ProviderLawStatusEntity[]
}

model Requirement {
  id          String          @id @default(uuid())
  lawId       String
  name        String
  description String
  type        RequirementType
  isMandatory Boolean

  law       Law        @relation(fields: [lawId], references: [id])
  documents Document[]
}

model Document {
  id              String    @id @default(uuid())
  providerId      String
  requirementId   String
  documentType    String
  originalName    String
  fileUrl         String
  hash            String    @unique
  status          DocStatus @default(PENDING)
  rejectionReason String?
  issueDate       DateTime
  expirationDate  DateTime
  createdAt       DateTime  @default(now())

  provider    Provider     @relation(fields: [providerId], references: [id])
  requirement Requirement  @relation(fields: [requirementId], references: [id])
  validations Validation[]
}

model Validation {
  id               String           @id @default(uuid())
  documentId       String
  technicalResult  ValidationResult
  logicalResult    ValidationResult
  regulatoryResult ValidationResult
  notes            String
  validatedBy      ValidatorType
  createdAt        DateTime         @default(now())

  document Document @relation(fields: [documentId], references: [id])
}

model ProviderLawStatusEntity {
  id             String            @id @default(uuid())
  providerId     String
  lawId          String
  status         ProviderLawStatus
  reviewDate     DateTime
  expirationDate DateTime

  provider Provider @relation(fields: [providerId], references: [id])
  law      Law      @relation(fields: [lawId], references: [id])

  @@unique([providerId, lawId])
}

model AuditLog {
  id        String   @id @default(uuid())
  entity    String
  entityId  String
  action    String
  details   String
  createdAt DateTime @default(now())
}
